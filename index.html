<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no">
<title>LIMENWALKER WORKSHOP</title>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<style>
  :root{
    --vwpx: 100vw; --vhpx: 100vh;
    --ff-ui:"Courier New", Courier, monospace;
    --line-color:rgba(255,255,255,.9);
    --gap:32px;
    --line-w:1px; --line-r:2px;
  }
  html,body{
    margin:0;padding:0;height:100%;background:#000;color:#fff;
    font-family:var(--ff-ui);overflow:hidden;
    -webkit-touch-callout:none;-webkit-tap-highlight-color:transparent;
  }
  *,*::before,*::after{box-sizing:border-box;}
  #view{position:fixed;inset:0;width:var(--vwpx);height:var(--vhpx);background:#000;z-index:0;}
  .proscenium{
    position:fixed;
    left:calc(var(--gap) + env(safe-area-inset-left));
    right:calc(var(--gap) + env(safe-area-inset-right));
    top:calc(var(--gap) + env(safe-area-inset-top));
    bottom:calc(var(--gap) + env(safe-area-inset-bottom));
    border:var(--line-w) solid var(--line-color);
    border-radius:var(--line-r);
    pointer-events:none;z-index:5;
  }
  #overlay{
    position:fixed;inset:0;
    display:flex;align-items:center;justify-content:center;
    background:rgba(0,0,0,.8);z-index:100;transition:opacity .5s ease;
  }
  #overlay.hidden{opacity:0;pointer-events:none;}
  #overlayContent{
    text-align:center;line-height:1.6;max-width:85vw;
    display:flex;flex-direction:column;gap:12px;
  }
  .stageText{font-size:clamp(16px,2.5vmin,22px);}
  .stageBtn{
    margin-top:20px;border:1px solid #fff;background:transparent;color:#fff;
    padding:.6em 1.4em;text-transform:uppercase;font-size:clamp(14px,2vmin,20px);
    cursor:pointer;
  }
  #infoText{
    position:fixed;top:20px;left:50%;transform:translateX(-50%);
    font-size:clamp(12px,1.8vmin,16px);opacity:.8;z-index:50;
  }
  #countdown{
    font-size:clamp(12px,1.8vmin,16px);opacity:.8;margin-top:10px;
  }
</style>
</head>
<body>
<canvas id="view"></canvas>
<div class="proscenium" aria-hidden="true"></div>
<div id="infoText">프로그램 시작을 위해 화면을 터치한 후 카메라, 마이크, 위치 센서 허용을 눌러주세요.</div>

<div id="overlay">
  <div id="overlayContent">
    <div id="msg" class="stageText"></div>
    <button id="startBtn" class="stageBtn" style="display:none;">PRESS HERE TO START</button>
    <div id="countdown" style="display:none;"></div>
  </div>
</div>

<script>
(()=>{

let audioCtx;
function beep(freq=880,dur=150){
  if(!audioCtx) audioCtx=new (window.AudioContext||window.webkitAudioContext)();
  const osc=audioCtx.createOscillator(),g=audioCtx.createGain();
  osc.type='square';osc.frequency.value=freq;g.gain.value=0.0001;
  osc.connect(g).connect(audioCtx.destination);
  const t=audioCtx.currentTime;
  g.gain.exponentialRampToValueAtTime(0.25,t+0.02);
  g.gain.exponentialRampToValueAtTime(0.0001,t+dur/1000);
  osc.start(t);osc.stop(t+dur/1000+0.02);
}

const overlay=document.getElementById('overlay');
const msg=document.getElementById('msg');
const startBtn=document.getElementById('startBtn');
const countdown=document.getElementById('countdown');
const infoText=document.getElementById('infoText');

let step=0;

function showText(t){ msg.textContent=t; }
function fadeOutOverlay(delay=0){ setTimeout(()=>overlay.classList.add('hidden'),delay); }
function showOverlay(){ overlay.classList.remove('hidden'); }

async function requestPermissions(){
  // 카메라/마이크/위치 센서 허용 요청
  try{
    await navigator.mediaDevices.getUserMedia({video:true,audio:true});
  }catch{}
  try{
    if(navigator.geolocation){
      navigator.geolocation.getCurrentPosition(()=>{},()=>{});
    }
  }catch{}
  try{
    if(typeof DeviceOrientationEvent!=='undefined' && typeof DeviceOrientationEvent.requestPermission==='function'){
      await DeviceOrientationEvent.requestPermission();
    }
  }catch{}
  try{
    if(typeof DeviceMotionEvent!=='undefined' && typeof DeviceMotionEvent.requestPermission==='function'){
      await DeviceMotionEvent.requestPermission();
    }
  }catch{}
}

document.body.addEventListener('touchend', startSequence,{once:true});
document.body.addEventListener('click', startSequence,{once:true});

async function startSequence(){
  infoText.style.display='none';
  await requestPermissions();
  step1();
}

function step1(){
  showText('WELCOME TO LIMENWALKER WORKSHOP');
  showOverlay();
  setTimeout(()=>{
    beep(880,120);
    startBtn.style.display='inline-block';
  },3000);
}

startBtn.addEventListener('click', ()=>{
  beep(660,150);
  startBtn.style.display='none';
  showText(`안녕하세요. 리멘워커 워크숍의 첫 번째 워크숍 발표를 찾아와주신 여러분에게 감사의 인사를 올립니다.
이곳은 무작위로 수집된 시간이 이성적으로 분류되어 예측가능한 
잠시후, 당신의 핸드폰 스크린 위로는 ‘당신이 바라보는 현실 공간’과 ‘이 공간을 탈출한 누군가가 바라보는 공간’이 동시에 투사될 것입니다.
3분 간의 시간 동안 당신은 공간을 자유롭게 거닐며, ‘이 공간을 탈출한 누군가가 바라보는 공간’이 함께 포착하시면 됩니다.`);

  countdown.style.display='block';
  let sec=60;
  countdown.textContent=`${sec}초 후 탐사가 시작됩니다.`;
  const timer=setInterval(()=>{
    sec--;countdown.textContent=`${sec}초 후 탐사가 시작됩니다.`;
    if(sec<=0){
      clearInterval(timer);
      showText('WALK : 공간을 탐사하세요.');
      countdown.style.display='none';
    }
  },1000);
}

})();
</script>
</body>
</html>
